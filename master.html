<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
  <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="0">

  <title>Sp22Anno Dashboard</title>

  <link href="css/bootstrap_5.1.3_.min.css" rel="stylesheet">

  <link href="css/style.css" rel="stylesheet">

  <style type="text/css">
  </style>

</head>

<body>

  <div class="bodywrap" id="bodywrap">

    <div class="page-cover" v-if="false">
      <div class="container pt-5 text-center">
        <div class="row">
          <div><h2>ç©ºé—´å…³ç³»ç†è§£æ•°æ®æ ‡æ³¨ 2022 ç®¡ç†é¢æ¿ (å¼€å‘ä¸­)</h2></div>
        </div>
        <div class="row">
          <div>
            <p>æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™â€¦â€¦</p>
          </div>
        </div>
      </div>
    </div>

    <!-- navbar start -->
    <nav
      class="navbar navbar-expand-lg navbar-dark"
      :class="ctrl.developing ? 'bg-success' : 'bg-dark'"
    >
      <div class="container">
        <a class="navbar-brand" href="#">ç©ºé—´å…³ç³»ç†è§£æ•°æ®æ ‡æ³¨ 2022 ç®¡ç†é¢æ¿ (å¼€å‘ä¸­)</a>
      </div>
    </nav>
    <!-- navbar end -->


    <div class="container page my-4">
      <div class="container py-2">
        <div class="row align-items-center">
          <div class="col col-12 col-md-3 col-lg-4 my-2">
            <div class="form-floating">
              <input
               class="form-control form-control-sm"
               type="text"
               v-model="ctrl.currentUser.name"
               placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å"
              >
              <label class="form-label">å§“å</label>
            </div>
          </div>
          <div class="col col-12 col-md-9 col-lg-8 my-2">
            <div class="form-floating">
              <input
               class="form-control form-control-sm"
               type="password"
               v-model="ctrl.currentUser.token"
               placeholder="è¯·è¾“å…¥æ‚¨çš„å¯†ç "
              >
              <label class="form-label">å¯†ç </label>
            </div>
          </div>
        </div>
        <div class="row align-items-center my-2">
          <div class="col col-12 my-2">
            <div>è‹¥è¦è¿›è¡Œå®¡æ ¸å·¥ä½œï¼Œè¯·ç§»æ­¥è‡³ <a href="./inspect" target="_blank">å®¡æ ¸å·¥å…·</a> ã€‚</div>
            <div>æ“ä½œæ­¥éª¤ï¼š</div>
            <div>1ã€å¦‚æœå¤ªä¹…æ²¡åˆ·æ–°ï¼Œç‚¹ã€Œåˆ·æ–°å…¨éƒ¨ã€ï¼›å¦åˆ™ç‚¹ã€ŒåŠ è½½ç¼“å­˜ã€</div>
            <div>2ã€ç­‰å¾…å¤„ç†å®Œæ¯•</div>
            <div>3ã€ç‚¹å‡»ã€Œå¼€å§‹å·¥ä½œã€ï¼ŒåŠ è½½å·¥ä½œé¡µé¢</div>
          </div>
          <div class="col col-12">
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="`btn-outline-dark`"
              @click="async ()=>{ctrl.started=false; await sync()}"
              title="ä»æœåŠ¡å™¨æ›´æ–°æœ€æ–°æ•°æ®ï¼ŒåŒ…æ‹¬ User, Task, Anno è¡¨ï¼Œä»¥åŠ Entry è¡¨ä¸­çš„åŸºæœ¬ä¿¡æ¯"
            >åˆ·æ–°å…¨éƒ¨</button>
            <button
              type="button"
              __v-show="ctrl.haveCache"
              class="btn btn-sm me-2 my-1"
              :class="`btn-outline-dark`"
              @click="async ()=>{ctrl.started=false; await loadCacheDB()}"
              title="åŠ è½½ç¼“å­˜æ•°æ®"
            >åŠ è½½ç¼“å­˜</button>
            <span class="text-danger" v-show="workerState.working">è¾…åŠ©çº¿ç¨‹å·¥ä½œä¸­ï¼Œè¯·ç¨ç­‰ï¼ï¼ï¼</span>
            <span class="text-danger" v-show="workerState.works.length">ï¼ˆè¿˜æœ‰ {{workerState.works.length}} é¡¹ä»»åŠ¡æ­£åœ¨æ’é˜Ÿï¼‰</span>
          </div>
          <div class="col col-12">
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="{'btn-outline-success': spDB.entries?.length, 'btn-outline-secondary': !spDB.entries?.length}"
              @click="async ()=>{ctrl.started=false; await syncEntryInfo()}"
              title="ä»æœåŠ¡å™¨æ›´æ–° Entry è¡¨ (ä»…åŸºæœ¬ä¿¡æ¯ï¼Œä¸å«æ–‡æœ¬å†…å®¹)"
            >åˆ·æ–° Entry è¡¨ (ä»…åŸºæœ¬ä¿¡æ¯ï¼Œä¸å«æ–‡æœ¬å†…å®¹)</button>
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="{'btn-outline-success': spDB.tasks?.length, 'btn-outline-secondary': !spDB.tasks?.length}"
              @click="async ()=>{ctrl.started=false; await syncTask()}"
              title="ä»æœåŠ¡å™¨æ›´æ–° Task è¡¨"
            >åˆ·æ–° Task è¡¨</button>
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="{'btn-outline-success': spDB.annos?.length, 'btn-outline-secondary': !spDB.annos?.length}"
              @click="async ()=>{ctrl.started=false; await syncAnno()}"
              title="ä»æœåŠ¡å™¨æ›´æ–° Anno è¡¨"
            >åˆ·æ–° Anno è¡¨</button>
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="{'btn-outline-success': spDB.users?.length, 'btn-outline-secondary': !spDB.users?.length}"
              @click="async ()=>{ctrl.started=false; await syncUser()}"
              title="ä»æœåŠ¡å™¨æ›´æ–° User è¡¨"
            >åˆ·æ–° User è¡¨</button>
          </div>
          <div class="col col-12" v-show="false">
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="{'btn-outline-success': spDB.entries?.[0]?.content?.material?.tokenList?.length, 'btn-outline-secondary': !spDB.entries?.[0]?.content?.material?.tokenList?.length}"
              @click="modalBox_open('upload-entries')"
              title="å› ç½‘ç»œä¼ è¾“ä¸å¤ªç¨³å®šï¼Œè€Œè¯­æ–™åº“è¾ƒå¤§ï¼Œæ•…è¯·ä»æœ¬åœ°é€‰æ‹©è¯­æ–™åº“æ–‡ä»¶è¿›è¡ŒåŠ è½½"
            >å¯¼å…¥ Entry è¡¨ï¼ˆå®Œæ•´)</button>
            <button
              type="button"
              v-if="spDB.entries?.[0]?.content?.material?.tokenList?.length"
              class="btn btn-sm me-2 my-1"
              :class="'btn-outline-primary'"
              @click="makeAnnoOnTexts"
              title="é…åˆè¯­æ–™æ–‡æœ¬æ›´æ–° anno ç»†èŠ‚"
            >é…åˆè¯­æ–™æ–‡æœ¬æ›´æ–° anno ç»†èŠ‚</button>
          </div>
          <div class="col col-12 text-muted small my-2">
            <div>ä¸Šæ¬¡åˆ·æ–°æ•´ä¸ªæ•°æ®åº“çš„æ—¶é—´æ˜¯ {{ctrl.lastTime}} ã€‚</div>
            <div>ä¸Šæ¬¡åˆ·æ–° Entry è¡¨çš„æ—¶é—´æ˜¯ {{ctrl.lastTimeDict?.entries}} ã€‚</div>
            <div>ä¸Šæ¬¡åˆ·æ–° User è¡¨çš„æ—¶é—´æ˜¯ {{ctrl.lastTimeDict?.users}} ã€‚</div>
            <div>ä¸Šæ¬¡åˆ·æ–° Task è¡¨çš„æ—¶é—´æ˜¯ {{ctrl.lastTimeDict?.tasks}} ã€‚</div>
            <div>ä¸Šæ¬¡åˆ·æ–° Anno è¡¨çš„æ—¶é—´æ˜¯ {{ctrl.lastTimeDict?.annos}} ã€‚</div>
            <div>
              <span>æ•°æ®çŠ¶æ€ï¼š</span>
              <span title="entries">{{spDB.entries.length ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="entriesExtended">{{spDB.state?.entriesExtended ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="entryDictBuilt">{{spDB.state?.entryDictBuilt ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="users">{{spDB.users.length ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="usersExtended">{{spDB.state?.usersExtended ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="userDictBuilt">{{spDB.state?.userDictBuilt ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="tasks">{{spDB.tasks.length ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="tasksExtended">{{spDB.state?.tasksExtended ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="taskDictBuilt">{{spDB.state?.taskDictBuilt ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="annos">{{spDB.annos.length ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="annosExtended">{{spDB.state?.annosExtended ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
              <span title="annoDictBuilt">{{spDB.state?.annoDictBuilt ? 'ğŸŸ¢' : 'ğŸ”´'}}</span>
            </div>
            <div>
              <button
                v-if="(!spDB.completelyExtended || !spDB.allDictsBuilt) && spDB.isNotEmpty"
                type="button"
                class="btn btn-sm me-2 my-1 btn-outline-dark"
                @click="async()=>{ctrl.started=false; await spDB.fix(); await saveDB();}"
                title="æ•°æ®è¡¥å…¨(å¯èƒ½å¡é¡¿ï¼Œè¯·è€å¿ƒç­‰å¾…)"
              >æ•°æ®è¡¥å…¨ (å¯èƒ½å¡é¡¿ï¼Œè¯·è€å¿ƒç­‰å¾…)</button>
            </div>
          </div>

          <div class="col col-12">
            <button
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="'btn-outline-dark'"
              @click="exportDB"
              title="å°†æ•´ä¸ªæ•°æ®åº“å¯¼å‡ºä¸ºjsonæ–‡ä»¶ï¼ˆéœ€è¦å…ˆåˆ·æ–°æ•°æ®åº“åˆ°æœ¬åœ°ï¼Œå¦åˆ™æ•°æ®å¯èƒ½ä¸å®Œæ•´ï¼›å…¶ä¸­Entryè¡¨å¯ä½¿ç”¨ç¦»çº¿ç‰ˆï¼‰"
            >å¯¼å‡ºæ•°æ®åº“ï¼ˆéœ€è¦å…ˆåˆ·æ–°æ•°æ®åº“åˆ°æœ¬åœ°ï¼‰</button>
            <a
              class="btn btn-sm me-2 my-1"
              :class="'btn-outline-dark'"
              href="https://github.com/2030NLP/sp22scripts/blob/main/SpaCE2022_DB.spec.md"
              target="_blank"
            >æŸ¥çœ‹æ•°æ®æ ¼å¼è¯´æ˜</a>
          </div>
          <div class="col col-12">
            <button
              v-if="spDB.completelyExtended && spDB.allDictsBuilt && spDB.isNotEmpty"
              type="button"
              class="btn btn-sm me-2 my-1"
              :class="`btn-info`"
              @click="async()=>{ctrl.started=true;await getMemoList();}"
              title="å¼€å§‹å·¥ä½œ"
            >å¼€å§‹å·¥ä½œ</button>
            <!-- <a
              class="btn btn-sm me-2 my-1"
              :class="'btn-outline-dark'"
              href="./todos"
              target="_blank"
            >æ‰“å¼€ä»»åŠ¡æ¿</a> -->
            <a
              class="btn btn-sm me-2 my-1"
              :class="'btn-outline-dark'"
              href="./memos"
              target="_blank"
            >æ‰“å¼€ç•™è¨€æ¿</a>
          </div>
        </div>
      </div>
    </div>

    <div class="container page my-4" v-if="ctrl.started">
      <div class="container py-2">
        <div class="row mt-2 mb-4">
          <div class="col">
            <ul class="nav nav-tabs">
              <li class="nav-item">
                <a class="nav-link" :class="ctrl.tab == TABS.userProgress ? 'active' : ''" href="#" @click="goTab('userProgress')">ç”¨æˆ·è¿›åº¦</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="ctrl.tab == TABS.functions ? 'active' : ''" href="#" @click="goTab('functions')">æ›´å¤šåŠŸèƒ½</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" :class="ctrl.tab == TABS.taskAssign ? 'active' : ''" href="#" @click="goTab('taskAssign')">åˆ†é…ä»»åŠ¡</a>
              </li>
            </ul>
          </div>
        </div>



        <div class="row align-items-center my-2" v-show="ctrl.tab == TABS.taskAssign">
          <div class="col col-12">
            <div>è¯´æ˜ï¼šåˆ†é…ä»»åŠ¡å‰ï¼Œè¯·å…ˆï¼š1ã€åœ¨åç«¯æ„å»ºä»»åŠ¡ï¼›2ã€åˆ·æ–°Taskè¡¨ï¼›3ã€åˆ·æ–°Entryè¡¨ã€‚</div>
          </div>
          <div class="col col-12">
            <div>è¯·è¿›è¡Œå‚æ•°è®¾ç½®ï¼š</div>
          </div>
          <div class="col col-12 col-sm-6 col-lg-4 my-2">
            <label class="form-label">æ¯ä¸ªç”¨æˆ·å¤šå°‘ä»»åŠ¡</label>
            <input
             class="form-control form-control-sm"
             type="number"
             v-model="assignData.settings.tasks_per_user"
            >
          </div>
          <div class="col col-12 col-sm-6 col-lg-4 my-2">
            <label class="form-label">æ¯ä¸ªä»»åŠ¡éœ€è¦å‡ åç”¨æˆ·å‚ä¸</label>
            <input
             class="form-control form-control-sm"
             type="number"
             v-model="assignData.settings.users_per_task"
            >
          </div>
          <div class="col col-12 col-sm-6 col-lg-4 my-2">
            <label class="form-label">ä»»åŠ¡ç±»å‹</label>
            <select
             class="form-select form-select-sm"
             v-model="assignData.settings.topic"
            >
              <option v-for="topic in assignTopics" :value="topic.value">{{topic.desc}}</option>
            </select>
          </div>
          <div class="col col-12 col-sm-6 col-lg-4 my-2">
            <label class="form-label">ä»»åŠ¡æ‰¹æ¬¡åç§°ï¼ˆç”¨äºç­›é€‰ï¼‰</label>
            <input
             class="form-control form-control-sm"
             type="text"
             v-model="assignData.settings.batchName"
            >
          </div>
          <div class="col col-12 my-2">
            <label class="form-label">è´¨æ£€é¢˜è®¾ç½®ï¼ˆJsonå­—ç¬¦ä¸²ï¼‰</label>
            <textarea
              class="form-control form-control-sm"
              v-model="assignData.settings.polygraphs_per_user_json_string"
              :class="{'is-invalid': assignData.polygraphs_per_user_json_string_error}"
            ></textarea>
            <div
              class="invalid-feedback"
              v-show="assignData.polygraphs_per_user_json_string_error"
            >Jsonè§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥</div>
          </div>
          <div class="col col-12 my-2">
            <label class="form-label">
              <span>é€‰æ‹©ç”¨æˆ·</span>
            </label>
            <div>
              <button
                type="button"
                class="btn btn-sm mx-2 my-1 btn-outline-dark"
                @click="selectUsersAuto"
              >è‡ªåŠ¨</button>
              <button
                type="button"
                class="btn btn-sm mx-2 my-1 btn-outline-dark"
                @click="selectUsersAll"
              >å…¨é€‰</button>
              <button
                type="button"
                class="btn btn-sm mx-2 my-1 btn-outline-dark"
                @click="selectUsersNone"
              >æ¸…é™¤</button>
            </div>
            <div
              class="form-control form-control-sm overflow-auto max-vh-40"
            >
              <button
                v-for="user in spDB.users"
                type="button"
                class="btn btn-sm me-2 my-1"
                :class="assignData.assignUserBoxDict[user.id] ? `btn-primary` : `btn-outline-secondary`"
                @click="()=>{assignData.assignUserBoxDict[user.id]=!assignData.assignUserBoxDict[user.id]}"
              >{{ user.currTaskGroup }} #{{ user.id }} {{ user.name }}</button>
            </div>
          </div>
          <div class="col col-12 col-sm-6 col-lg-4 my-2">
            <div class="form-check form-switch" :title="`é€šå¸¸å¤§å®¶åœ¨æ ‡æ³¨æ—¶è¦åˆ†é…æ–°ä»»åŠ¡çš„è¯ï¼Œé€‰ã€Œå¦ã€ï¼›\nå¦‚æœè¦æ€»åœ°è¿›è¡Œä¸‹ä¸€è½®åˆ†é…ï¼Œé€šå¸¸é€‰ã€Œæ˜¯ã€`">
              <input class="form-check-input" type="checkbox" role="switch" v-model="assignData.settings.retrieve">
              <label class="form-check-label">æ˜¯å¦æ”¶å›æœªå®Œæˆçš„ä»»åŠ¡ï¼ˆ{{assignData.settings.retrieve?'æ˜¯':'å¦'}}ï¼‰</label>
            </div>
          </div>
        </div>



        <div class="row align-items-center my-2" v-show="ctrl.tab == TABS.taskAssign">
          <div class="col col-12">
            <button
              type="button"
              class="btn btn-sm me-2 my-1 btn-outline-primary"
              @click="planAssigment"
              title="å¯¹ä»»åŠ¡åˆ†é…è¿›è¡Œè§„åˆ’"
            >å¼€å§‹è§„åˆ’</button>
          </div>
          <template v-if="assignData.analysis.length">
            <div class="col col-12">
              <h4 class="mt-3 mb-2">{{ assignData.undone ? 'è§„åˆ’' : 'æ‰§è¡Œ'}}ç»“æœ</h4>
            </div>
            <div class="col col-12">
              <div class="text-muted">æ‰¹æ¬¡ç¼–å·ï¼š{{ assignData.batch }}</div>
            </div>
            <div class="col col-12 my-2">
              <div class="fw-bold">å…·ä½“åˆ°æ¯ä¸ªæ ‡æ³¨è€…ï¼š</div>
              <div class="text-muted">ç»¿è‰²è¡¨ç¤ºæ–°ä»»åŠ¡ï¼Œç°è‰²è¡¨ç¤ºä¹‹å‰å°±åˆ†é…ç»™ä»–äº†</div>
              <div class="text-muted">ç€è‰²è¡¨ç¤ºæ­£å¸¸ä»»åŠ¡ï¼Œæ¡†çº¿è¡¨ç¤ºä¸ºè´¨æ£€é¢˜</div>
            </div>
            <div class="col col-12">
              <ul class="list-group max-vh-40 overflow-auto border border-1">
                <li class="list-group-item" v-for="pair in assignData.planPerUser">
                  <div>
                    <span>{{ `#${pair[0]} ${spDB.user(pair[0])?.name}` }}</span> åˆ†é…åˆ°çš„ {{pair[1]?.length}} æ¡ä»»åŠ¡æ˜¯ï¼š
                  </div>
                  <div>
                    <button
                      v-for="task_id in pair[1]"
                      type="button"
                      class="btn btn-sm me-2 my-1"
                      :class="classAssignAnalisisByUser(pair[0], task_id)"
                    >#{{ task_id }}</button>
                  </div>
                </li>
              </ul>
            </div>
            <div class="col col-12 my-2">
              <div class="fw-bold">å…·ä½“åˆ°æ¯ä¸ªä»»åŠ¡ï¼š</div>
            </div>
            <div class="col col-12">
              <ul class="list-group max-vh-40 overflow-auto border border-1">
                <li class="list-group-item" v-for="item in assignData.analysis">
                  <div>
                    <span>ã€Œ{{item?.plan?.topic}} ä»»åŠ¡ #{{item.id}}</span><span></span> / <span></span><span>è¯­æ–™ #{{item?.plan?.entry}}ã€</span>
                    <!-- <br v-if="item.new_to?.length"/> -->
                    <span v-if="item.new_to?.length">
                      åˆ†é…ç»™ï¼š
                      <span class="me-2 text-success __fw-bold" v-for="guy in item.new_guys">#{{guy}} {{spDB.user(guy)?.name}}</span>
                      <span class="me-2" v-for="guy in item.solid_guys">#{{guy}} {{spDB.user(guy)?.name}}</span>
                      ã€‚
                    </span>
                    <!-- <br v-if="item.canceled_guys?.length"/> -->
                    <span v-if="item.canceled_guys?.length" class="text-muted">
                      ä¸å†åˆ†é…ç»™ï¼š
                      <s class="me-2" v-for="guy in item.canceled_guys">#{{guy}} {{spDB.user(guy)?.name}}</s>
                      ã€‚
                    </span>
                  </div>
                </li>
              </ul>
            </div>
            <div class="col col-12 my-2">
              <button
                type="button"
                class="btn btn-sm me-2 my-1 btn-danger"
                __click="doAssigment"
                @click="modalBox_open('confirm', {desc: 'ç¡®å®šè¦æ‰§è¡Œè§„åˆ’å¥½çš„ä»»åŠ¡å®‰æ’å—ï¼Ÿ', action: doAssigment})"
                title="å¼€å§‹æ‰§è¡Œè§„åˆ’å¥½çš„ä»»åŠ¡å®‰æ’"
                v-if="assignData.undone"
              >å¼€å§‹æ‰§è¡Œ</button>
              <button
                type="button"
                class="btn btn-sm me-2 my-1 btn-primary"
                __click="doAssigment"
                @click="exportPlan"
                title="å¼€å§‹æ‰§è¡Œè§„åˆ’å¥½çš„ä»»åŠ¡å®‰æ’"
                v-if="assignData.undone"
              >å¯¼å‡ºè®¡åˆ’</button>
              <button
                type="button"
                class="btn btn-sm me-2 my-1"
                :class="assignData.undone ? 'btn-outline-secondary' : 'btn-outline-success'"
                @click="()=>{if(assignData.undone){cancelAssigment();}else{cleanAssigment();}}"
                :title="assignData.undone ? 'æ’¤é™¤è§„åˆ’å¥½çš„ä»»åŠ¡å®‰æ’' : 'æ¸…é™¤ä»¥ä¸Šä¿¡æ¯'"
              >{{ assignData.undone ? 'æ’¤é™¤è§„åˆ’' : 'çŸ¥é“äº†ï¼Œæ¸…é™¤'}}</button>
            </div>
            <div class="col col-12 my-2" v-if="'inserted' in assignData.result">
              <div>æ‰§è¡Œç»“æœï¼š</div>
            </div>
            <div class="col col-12 my-2" v-if="'inserted' in assignData.result">
              <div>ä¿®æ”¹ï¼š {{ assignData.result.replaced }}</div>
              <div>æ–°å¢ï¼š {{ assignData.result.inserted }}</div>
              <div>å¼‚å¸¸ï¼š {{ assignData.result.strange }}</div>
            </div>
          </template>
        </div>


        <user-list-control
          v-show="ctrl.tab == TABS.userProgress"
          :db="spDB"
          :settings="ctrl"
          :managers="spDB.users.filter(user=>user.role?.includes?.('manager'))"
        >
          <button
            type="button"
            class="btn btn-sm btn-outline-dark my-1 me-2"
            @click="modalBox_open('user-importer')"
            title="æ–°å¢ç”¨æˆ·"
          >æ–°å¢ç”¨æˆ·</button>
        </user-list-control>


        <div class="row align-items-center my-2" v-show="ctrl.tab == TABS.userProgress">
          <div class="col col-12 my-2">
            <div>å·²å®¡æ ¸ {{spDB?.annos?.filter?.(it=>it?.content?.review)?.length}} / {{spDB?.annos?.length}}</div>
          </div>
        </div>

        <div class="row align-items-center my-2" v-show="ctrl.tab == TABS.userProgress">
          <div class="container my-2">
            <div
              class="row align-items-center my-1 border rounded p-2"
              v-show="ctrl.currentUser?.id==user.manager||!ctrl.showOnlyMyMembers"
              v-for="user in spDB.users"
              :key="user.id"
            >
              <div class="col col-12 col-md-6 col-lg-4 mb-1">
                <span class="__fw-bold fs-6 me-2">{{user.name}}</span>
                <span class="badge rounded-pill bg-light text-dark me-1">#{{user.id}}</span>
                <span v-for="role in user.role" class="badge rounded-pill bg-light _border _border-primary text-primary me-1">{{role}}</span>
                <span v-if="user.quitted" class="badge rounded-pill bg-danger me-1">å·²é€€å‡º</span>
              <!-- </div>
              <div class="col col-12 col-sm-6 col-md-3 my-2"> -->
                <span class="badge bg-light text-dark me-1" :title="ç»„åˆ«">{{user.currTaskGroup}}</span>
                <span class="badge bg-light text-dark me-1" v-if="user.manager" :title="`ç»„é•¿ï¼š${spDB.user(user.manager)?.name}`">{{spDB.user(user.manager)?.name}}</span>
              <!-- </div>
              <div class="col col-12 col-sm-6 col-md-3 my-2"> -->
                <span class="badge bg-light text-dark me-1" :title="å½“å‰ä»»åŠ¡">{{user.currBatchName??Sp22FN.topic_regulation(user.currTask)}}</span>
                <span class="badge bg-light text-dark me-1">å·²æ ‡æ€»é‡ï¼š{{user.allAnnos?.length}}</span>
                <template v-for="sum in [inspectionSum(user)]"><span
                  class="badge me-1"
                  :class="sum?.passRatio>=0.9 ? 'bg-success text-light' : sum?.passRatio>=0.8 ? 'bg-light text-success border border-1 border-success' : sum?.passRatio==null ? 'bg-light text-dark' : sum?.passRatio<=0.6 ? 'bg-danger text-light' : 'bg-light text-danger border border-1 border-danger'"
                >å®¡æ ¸é€šè¿‡ç‡ï¼š{{sum?.passRatio?.toFixed?.(3)??'null'}}</span>
                <span class="badge bg-light text-dark me-1">å·²å®¡ï¼š{{inspectionSum(user)?.sum}}</span></template>
              </div>
              <div class="col col-12 col-md-6 col-lg-6 my-1">
                <div class="progress" :class="{'bg-success bg-opacity-25': userProgress(user).done}" title="å½“å‰ä»»åŠ¡è¿›åº¦">
                  <div
                    class="progress-bar bg-success"
                    role="progressbar"
                    :style="`width: ${userProgress(user).pct};`"
                    :aria-valuenow="userProgress(user).mn"
                    :aria-valuemax="userProgress(user).bg"
                    aria-valuemin="0"
                  >å½“å‰ä»»åŠ¡è¿›åº¦ã€€{{ userProgress(user).cDoneLen }}/{{ userProgress(user).cDueLen }}</div>
                </div>
              </div>
              <div class="col col-12 col-md-12 col-lg-2 mt-1">
                <button
                  type="button"
                  class="btn btn-sm me-2 my-1 btn-light"
                  :title="`æŸ¥çœ‹ ${user.name} æ‰€æ ‡æ³¨çš„å…·ä½“æƒ…å†µ`"
                  @click="()=>{sortUserAnnos(user);modalBox_open('user-progress', user);}"
                >æ ‡æ³¨è¯¦æƒ…</button>
                <button
                  type="button"
                  class="btn btn-sm me-2 my-1 btn-light"
                  :title="`æŸ¥çœ‹æ›´å¤šå…³äº ${user.name} çš„ä¿¡æ¯`"
                  @click="modalBox_open('user-detail', user)"
                >æ›´å¤š</button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>



    <!-- Modal -->
    <div class="modal-wrap" style="display: block;" ref="modal_wrap">
      <div class="modal" v-show="modalBox.data.show" :class="{show: modalBox.data.show}">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">



          <div class="modal-content" v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['entry-detail']">
            <div class="modal-body" v-for="entry in [modalBox.data?.kwargs]">
              <div class="row align-items-center my-2">

                <div class="col-12">
                  <h4 class="mt-2">è¯­æ–™è¯¦æƒ…</h4>
                </div>

                <div class="col-12">
                  <h5 class="mt-2">åŸºæœ¬ä¿¡æ¯</h5>
                </div>

                <div class="col-12">
                  <entry-card
                    :entry="entry"
                    :db="dbBasic"
                    @open-modal="(value)=>{modalBox_open(...value)}"
                    @update-entry="(value)=>{updateOneEntry(value)}"
                  ></entry-card>
                </div>

                <div class="col-12">
                  <h5 class="mt-2">æ›´å¤šä¿¡æ¯</h5>
                </div>

                <div class="col-12">
                  <div v-show="entry.originId">
                    <span class="badge bg-light text-dark text-wrap my-1 me-2">åŸå¥ç¼–å·: {{entry.originId}}</span>
                  </div>
                  <div v-show="entry.version">
                    <span class="badge bg-light text-dark text-wrap my-1 me-2">ç‰ˆæœ¬: {{entry.version}}</span>
                  </div>
                  <div v-show="entry.deleted">
                    <span class="badge bg-danger text-light text-wrap my-1 me-2">å·²åˆ é™¤</span>
                  </div>
                  <div v-show="entry.info">
                    <span class="badge bg-light text-dark text-wrap my-1 me-2">æ›´å¤šä¿¡æ¯: {{entry.info}}</span>
                  </div>
                  <!-- <div v-show="Object.keys(entry.results).length">
                    <span class="badge bg-light text-dark text-wrap my-1 me-2">å‚è€ƒä¿¡æ¯: {{entry.results}}</span>
                  </div> -->
                </div>

                <div class="col-12">
                  <h5 class="mt-2">å·²æäº¤çš„æ ‡æ³¨</h5>
                </div>

                <div class="col-12" v-for="anno_id in entry.allAnnos">
                  <div class="card my-1" v-for="anno in [spDB.anno(anno_id)]" :key="anno.id">
                    <div class="col-12">
                      <anno-card
                        :anno="anno"
                        :db="dbBasic"
                        @submit-review="(value)=>{saveAnnoReview(...value)}"
                        @open-modal="(value)=>{modalBox_open(...value)}"
                        @update-anno="(value)=>{updateOneAnno(value)}"
                      ></anno-card>
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <h5 class="mt-2">å…³è”çš„ä»»åŠ¡</h5>
                </div>

                <div class="col-12" v-for="task_id in entry.allTasks">
                  <task-card
                    v-for="task in [spDB.task(task_id)]"
                    :task="task"
                    :db="dbBasic"
                    @open-modal="(value)=>{modalBox_open(...value)}"
                  ></task-card>
                </div>

              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hide();}">å…³é—­</button>
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hideTotal();}" v-show="modalBox.data.history.length>1">å…³é—­å…¨éƒ¨ ({{modalBox.data.history.length}})</button>
            </div>
          </div>



          <div class="modal-content" v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['anno-detail']">
            <div class="modal-body" v-for="anno in [modalBox.data?.kwargs]">
              <div class="row align-items-center my-2">

                <div class="col-12">
                  <h4>æ ‡æ³¨è¯¦æƒ…</h4>
                </div>

                <div class="col-12" v-for="entry in [spDB.entry(anno.entry)]">
                  <entry-card
                    :entry="entry"
                    :db="dbBasic"
                    @open-modal="(value)=>{modalBox_open(...value)}"
                    @update-entry="(value)=>{updateOneEntry(value)}"
                  ></entry-card>
                </div>

                <div class="col-12">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-dark my-1 me-2"
                  >anno-{{anno?.topic}}-#{{anno?.id}}-{{spDB.user(anno?.user)?.name}}</button>
                  <div v-for="annot in anno.content?.annotations??[]">
                    <span class="badge bg-light text-dark text-wrap my-1 me-2">{{annot}}</span>
                  </div>
                  <div>
                    <span>Schemaï¼š</span><span class="badge bg-light text-dark text-wrap my-1 me-2">{{anno?.content?._ctrl?.schema}}</span>
                  </div>
                  <div v-if="anno?._timeInfo">
                    <span>æœ€åæäº¤æ—¶é—´ï¼š</span><span class="badge bg-light text-dark text-wrap my-1 me-2">{{(new Date(anno?._timeInfo?.lastAt)).toLocaleString()}}</span><br/>
                    <span>é¦–æ¬¡æ“ä½œæ—¶é•¿ï¼š</span><span class="badge bg-light text-dark text-wrap my-1 me-2">{{anno?._timeInfo?.firstDur/1000}}s</span><br/>
                    <span>ç´¯è®¡æ“ä½œæ¬¡æ•°ï¼š</span><span class="badge bg-light text-dark text-wrap my-1 me-2">{{anno?._timeInfo?.detail?.length}}æ¬¡</span><br/>
                    <span>ç´¯è®¡æ“ä½œæ—¶é•¿ï¼š</span><span class="badge bg-light text-dark text-wrap my-1 me-2">{{anno?._timeInfo?.totalDur/1000}}s</span><br/>
                    <span>ç´¯è®¡æ—¶é•¿è·¨åº¦ï¼š</span><span class="badge bg-light text-dark text-wrap my-1 me-2">{{anno?._timeInfo?.stride/1000}}s</span>
                  </div>
                  <task-card
                    v-for="task in [spDB.task(anno.task)]"
                    :task="task"
                    :db="dbBasic"
                    @open-modal="(value)=>{modalBox_open(...value)}"
                  ></task-card>
                  <button
                    v-for="user in [spDB.user(anno.user)]"
                    type="button"
                    class="btn btn-sm btn-outline-dark my-1 me-2"
                    @click="modalBox_open('user-progress', user)"
                  >user#{{user?.id}} {{user?.name}}</button>
                </div>


              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hide();}">å…³é—­</button>
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hideTotal();}" v-show="modalBox.data.history.length>1">å…³é—­å…¨éƒ¨ ({{modalBox.data.history.length}})</button>
            </div>
          </div>



          <div class="modal-content" v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['task-detail']">
            <div class="modal-body" v-for="task in [modalBox.data?.kwargs]">
              <div class="row align-items-center my-2">

                <div class="col-12">
                  <h4>ä»»åŠ¡è¯¦æƒ…</h4>
                </div>

                <div class="col-12">
                  <button
                    type="button"
                    class="btn btn-sm btn-light my-1 me-2"
                  >task#{{task?.id}}</button>
                  <div>
                    <span class="badge bg-light text-dark text-wrap my-1 me-2">{{task}}</span>
                  </div>
                </div>

                <div class="col-12" v-for="entry in [spDB.entry(task.entry)]">
                  <entry-card
                    :entry="entry"
                    :db="dbBasic"
                    @open-modal="(value)=>{modalBox_open(...value)}"
                    @update-entry="(value)=>{updateOneEntry(value)}"
                  ></entry-card>
                </div>

                <div class="col-12">
                  <h5>å·²æäº¤çš„æ ‡æ³¨ï¼ˆ{{task.submitters?.length}}ï¼‰</h5>
                  <div class="card my-1" v-for="user_id in task.submitters">
                    <div class="col-12" v-for="anno_id in [spDB.getAnnoByUserAndTask(user_id, task.id)]">
                      <!-- <anno-card
                        v-for="anno in [spDB.anno(anno_id)]"
                        :anno="anno"
                        :db="dbBasic"
                        :key="anno.id"
                        @submit-review="(value)=>{saveAnnoReview(...value)}"
                        @open-modal="(value)=>{modalBox_open(...value)}"
                        @update-anno="(value)=>{updateOneAnno(value)}"
                      ></anno-card> -->
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <h5>åˆ†é…ç»™{{task.to?.length}}äºº</h5>
                  <template v-for="user_id in task.to">
                    <button
                      v-for="user in [spDB.user(user_id)]"
                      type="button"
                      class="btn btn-sm btn-outline-dark my-1 me-2"
                      @click="modalBox_open('user-progress', user)"
                    >user#{{user?.id}} {{user?.name}}</button>
                  </template>
                </div>

              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hide();}">å…³é—­</button>
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hideTotal();}" v-show="modalBox.data.history.length>1">å…³é—­å…¨éƒ¨ ({{modalBox.data.history.length}})</button>
            </div>
          </div>


          <template
            v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['user-editor']"
          >
            <user-editor
              :db="dbBasic"
              :box="modalBox"
              :user="modalBox.data?.kwargs"
              @check-error-on-save="alertBox.pushAlert('å­˜åœ¨é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼', 'warning')"
              @save="(value)=>{saveUpdatedUser(modalBox.data?.kwargs, value)}"
            ></user-editor>
          </template>


          <template
            v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['user-importer']"
          >
            <user-importer
              :db="dbBasic"
              :box="modalBox"
              @check-error-on-save="(value)=>{alertBox.pushAlert('å­˜åœ¨é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼', 'warning', null, value)}"
              @save="async(value)=>{let messages = await makeNewUsers(value); let resultText='æ‰§è¡Œç»“æœï¼š\n'+messages.join('\n'); modalBox_open('confirm', {desc: resultText, action: ()=>{}, closetext: 'å…³é—­', confirmtext: 'çŸ¥é“äº†'} );}"
            ></user-importer>
          </template>


          <template
            v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['user-detail']"
          ><modal-content
            :box="modalBox"
            v-for="user in [modalBox.data?.kwargs]"
            :key="user.id"
          >

            <div class="container">
              <div class="row align-items-center my-2">
                <div class="col-12">
                  <h5>{{user.name}}
                    <span v-for="role in user.role" class="badge rounded-pill bg-primary mx-1">{{role}}</span>
                    <span v-if="user.quitted" class="badge rounded-pill bg-danger mx-2">å·²é€€å‡º</span>
                  </h5>
                </div>
              </div>
              <div class="row align-items-center my-2">
                <div class="col-12">
                  <p>ç¼–å·ï¼š{{user.id}}</p>
                  <p>åˆ†ç»„ï¼š{{user.currTaskGroup}}</p>
                  <p>ç»„é•¿ï¼š{{spDB.user(user.manager)?.name}}</p>
                  <p>å½“å‰ä»»åŠ¡ç±»å‹ï¼š{{Sp22FN.topic_regulation(user.currTask)}}</p>
                  <p>æœºæ„ç¼©å†™ï¼š{{user?.info?.inst_abbr}}</p>
                  <p>æœºæ„ï¼š{{user?.info?.institution}}</p>
                  <p>ç”µè¯ï¼š{{user?.info?.phone}}</p>
                  <p>é‚®ç®±ï¼š{{user?.info?.email}}</p>
                  <p>å¾®ä¿¡ï¼š{{user?.info?.wechat}}</p>
                  <p>å…¶ä»–ï¼š{{user?.info?.other}}</p>
                </div>
              </div>
              <div class="row align-items-center my-2">
                <div class="col-12">
                  <button
                    type="button"
                    class="btn btn-sm me-2 my-1 btn-outline-secondary"
                    :title="`ç¼–è¾‘ ${user.name} çš„èµ„æ–™`"
                    @click="modalBox_open('user-editor', user)"
                  >ç¼–è¾‘èµ„æ–™</button>
                  <button
                    v-if="!(user.role??[]).includes('admin')"
                    type="button"
                    class="btn btn-sm me-2 my-1 btn-outline-secondary btn-copy-token"
                    :title="`ç‚¹å‡»æ‹·è´ ${user.name} çš„å¯†ç `"
                    :data-clipboard-text="`#${user.id} ${user.name} çš„å¯†ç æ˜¯ï¼š ${user.token}`"
                  >æ‹·è´å¯†ç </button>
                  <button
                    v-if="(user.role??[]).includes('admin')"
                    type="button"
                    class="btn btn-sm me-2 my-1 btn-outline-secondary btn-copy-token"
                    :title="`ç‚¹å‡»æ‹·è´ ${user.name} çš„å¯†ç `"
                    :data-clipboard-text="`ä¸èƒ½æ‹·è´ç®¡ç†å‘˜çš„å¯†ç `"
                  >æ‹·è´å¯†ç </button>
                  <button
                    type="button"
                    v-if="!user.quitted"
                    class="btn btn-sm me-2 my-1 btn-outline-secondary"
                    :title="`ç»™ ${user.name} æ·»åŠ â€œå·²é€€å‡ºâ€æ ‡è®°`"
                    __on:click="modalBox_open('user-set-quitted', user)"
                    @click="modalBox_open('confirm', {desc: `ç¡®å®šè¦å°†ç”¨æˆ· ${user?.name} æ ‡è®°ä¸ºâ€œå·²é€€å‡ºâ€å—ï¼Ÿ`, action: (()=>{setAsQuitted(user);}),})"
                  >æ ‡è®°é€€å‡º</button>
                  <button
                    type="button"
                    v-if="user.quitted"
                    class="btn btn-sm me-2 my-1 btn-outline-secondary"
                    :title="`ä¸º ${user.name} ç§»é™¤â€œå·²é€€å‡ºâ€æ ‡è®°`"
                    __on:click="modalBox_open('user-unset-quitted', user)"
                    @click="modalBox_open('confirm', {desc: `ç¡®å®šè¦å»é™¤ç”¨æˆ· ${user?.name} çš„â€œå·²é€€å‡ºâ€æ ‡è®°å—ï¼Ÿ`, action: (()=>{setNotQuitted(user);}),})"
                  >ä¸å†é€€å‡º</button>
                  <button
                    type="button"
                    v-if="(!user?.role?.includes?.('inspector'))&&(!user?.role?.includes?.('super-inspector'))"
                    class="btn btn-sm me-2 my-1 btn-outline-secondary"
                    :title="`å°† ${user.name} è®¾ç½®ä¸ºå®¡æ ¸å‘˜ï¼ˆinspectorï¼‰`"
                    @click="modalBox_open('confirm', {desc: `ç¡®å®šè¦å°† ${user.name} è®¾ç½®ä¸ºå®¡æ ¸å‘˜å—ï¼Ÿ`, action: (()=>{setAsInspector(user);}),})"
                  >è®¾ä¸ºå®¡æ ¸å‘˜</button>
                  <button
                    type="button"
                    v-if="(user?.role?.includes?.('inspector'))||(user?.role?.includes?.('super-inspector'))"
                    class="btn btn-sm me-2 my-1 btn-outline-secondary"
                    :title="`å°† ${user.name} çš„å®¡æ ¸å‘˜ï¼ˆinspectorï¼‰èº«ä»½æ’¤é™¤`"
                    @click="modalBox_open('confirm', {desc: `ç¡®å®šè¦å°† ${user.name} çš„å®¡æ ¸å‘˜èº«ä»½æ’¤é™¤å—ï¼Ÿ`, action: (()=>{setNotInspector(user);}),})"
                  >æ’¤é™¤å®¡æ ¸å‘˜</button>
                </div>
              </div>
            </div>

            <template #footer>
              <button type="button" class="btn btn-sm btn-outline-dark me-2" @click="modalBox_open('user-progress', user)">æ ‡æ³¨è¿›åº¦</button>
            </template>
          </modal-content></template>

          <div class="modal-content" v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['user-progress']">
            <div class="modal-header" v-for="user in [modalBox.data?.kwargs]">
              <div class="container">
                <div class="row align-items-center my-2">
                  <div class="col-6 col-sm-6 col-md-3 my-1">
                    <h5>{{user.name}}</h5>
                  </div>
                  <div class="col-6 col-sm-6 col-md-3 my-1">
                    <span v-for="sum in [inspectionSum(user)]"
                      class="badge me-1"
                      :class="sum?.passRatio>=0.9 ? 'bg-success text-light' : sum?.passRatio>=0.8 ? 'bg-light text-success border border-1 border-success' : sum?.passRatio==null ? 'bg-light text-dark' : sum?.passRatio<=0.6 ? 'bg-danger text-light' : 'bg-light text-danger border border-1 border-danger'"
                    >é€šè¿‡ç‡ï¼š {{sum.passRatio?.toFixed?.(3)??'null'}} = {{sum.true??0}}/{{sum.sum??0}}</span>
                  </div>
                  <div class="col-12 col-sm-12 col-md-6 my-2">
                    <div class="progress" :class="{'bg-success bg-opacity-25': userProgress(user).done}" title="æ ‡æ³¨è¿›åº¦">
                      <div
                        class="progress-bar bg-success"
                        role="progressbar"
                        :style="`width: ${userProgress(user).pct};`"
                        :aria-valuenow="userProgress(user).mn"
                        :aria-valuemax="userProgress(user).bg"
                        aria-valuemin="0"
                      >{{ userProgress(user).cDoneLen }}/{{ userProgress(user).cDueLen }}</div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="input-group input-group-sm my-2">
                      <label class="input-group-text">ä»»åŠ¡</label>
                      <select
                       class="form-select form-select-sm"
                       v-model="ctrl.userAnnoFilter.topic"
                      >
                        <option v-for="topic in spDB.topics()" :value="topic">{{topic}}</option>
                        <option value="ã€emptyã€‘">ã€emptyã€‘</option>
                        <option value="ã€allã€‘">ã€allã€‘</option>
                      </select>
                      <label class="input-group-text">æ‰¹æ¬¡</label>
                      <select
                       class="form-select form-select-sm"
                       v-model="ctrl.userAnnoFilter.batchName"
                      >
                        <option v-for="batchName in spDB.batchNames()" :value="batchName">{{batchName}}</option>
                        <option value="ã€emptyã€‘">ã€emptyã€‘</option>
                        <option value="ã€allã€‘">ã€allã€‘</option>
                      </select>
                      <button type="button" class="btn btn-sm btn-outline-secondary" @click="()=>{sortUserAnnos(user);}">æ’åº</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal-body" v-for="user in [modalBox.data?.kwargs]">
              <div
                class="row align-items-center my-3 border border-secondary border-2 rounded"
                v-for="anno in userAnnos.list"
                __v-for="anno in lo.sortBy(user.allAnnos.map(it=>spDB.anno(it)), [annoSortFn, it=>(-it.batch)])"
                :key="anno.id"
                v-show="[anno.topic, 'ã€allã€‘'].includes(ctrl.userAnnoFilter.topic)&&[anno.batchName??'ã€emptyã€‘', 'ã€allã€‘'].includes(ctrl.userAnnoFilter.batchName??'ã€emptyã€‘')">

                <div class="col-12">
                  <task-card
                    v-for="task in [spDB.task(anno.task)]"
                    :task="task"
                    :db="dbBasic"
                    @open-modal="(value)=>{modalBox_open(...value)}"
                  ></task-card>
                </div>

                <div class="col-12" v-for="entry in [spDB.entry(anno.entry)]">
                  <entry-card
                    :entry="entry"
                    :db="dbBasic"
                    @open-modal="(value)=>{modalBox_open(...value)}"
                    @update-entry="(value)=>{updateOneEntry(value)}"
                  ></entry-card>
                </div>

                <div class="col-12">
                  <anno-card
                    :anno="anno"
                    :db="dbBasic"
                    @submit-review="(value)=>{saveAnnoReview(...value)}"
                    @open-modal="(value)=>{modalBox_open(...value)}"
                    @update-anno="(value)=>{updateOneAnno(value)}"
                  ></anno-card>
                </div>

              </div>
            </div>

            <div class="modal-footer" v-for="user in [modalBox.data?.kwargs]">
              <button type="button" class="btn btn-sm btn-outline-dark me-2" @click="modalBox_open('user-detail', user)">ç”¨æˆ·èµ„æ–™</button>
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hide()}">å…³é—­</button>
              <button type="button" class="btn btn-sm btn-secondary" @click="()=>{modalBox.hideTotal();}" v-show="modalBox.data.history.length>1">å…³é—­å…¨éƒ¨ ({{modalBox.data.history.length}})</button>
            </div>
          </div>









          <modal-content
            v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['default']"
            :box="modalBox"
          >
            <div class="row align-items-center my-2">
              <div class="col-12">
                <p>ğŸ˜„</p>
              </div>
            </div>
          </modal-content>

          <modal-content
            v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['confirm']"
            :box="modalBox"
            :needconfirm="true"
            @confirm="()=>{modalBox.data?.kwargs?.action?.();modalBox.hide();}"
            :closetext="modalBox.data?.kwargs.closetext??'å–æ¶ˆ'"
            :confirmtext="modalBox.data?.kwargs.confirmtext"
            :confirmstyle="modalBox.data?.kwargs.confirmstyle"
          >
            <div class="row align-items-center my-2">
              <div class="col-12">
                <p class="pre-wrap">{{ modalBox.data?.kwargs?.desc }}</p>
              </div>
            </div>
          </modal-content>

          <modal-content
            v-if="MODAL_THEMES[modalBox.data.theme] == MODAL_THEMES['upload-entries']"
            :box="modalBox"
          >
            <form class="row align-items-center my-2" name="file-form" id="filePicker">
              <div class="col-md-8 my-2">
                <input
                  type="file"
                  class="form-control form-control-sm"
                  name="file-input"
                  id="file-input"
                  accept=".json, .txt"
                />
              </div>
              <div class="btn-group btn-group-sm col-md-4 my-2">
                <button
                  type="button"
                  name="do_import"
                  id="do_import"
                  @click="onImportEntryTable"
                  class="btn btn-primary"
                >å¯¼å…¥</button>
              </div>
            </form>
          </modal-content>

        </div>
      </div>
    </div>


    <!-- Alert -->
    <div class="alert-wrap" style="display: block;" ref="alert_wrap">
      <transition name="fade" v-for="alert in alertBox.data.alerts">
        <div v-show="alert?.show" class="alert alert-dismissible" :class="'alert-'+(alert?.type ?? 'info')">
          <button type="button" class="btn-close" @click="alertBox.removeAlert(alert?.idx)"></button>
          <div>{{alert?.content}}</div>
        </div>
      </transition>
    </div>

  </div>
  <!-- bodywrap end -->

  <script type="module" src="js/master.mjs.js"></script>
</body>

</html>
